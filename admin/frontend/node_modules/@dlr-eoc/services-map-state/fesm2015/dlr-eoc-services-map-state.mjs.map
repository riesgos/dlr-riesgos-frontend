{"version":3,"file":"dlr-eoc-services-map-state.mjs","sources":["../../../projects/services-map-state/src/lib/types/map-state.ts","../../../projects/services-map-state/src/lib/map-state.service.ts","../../../projects/services-map-state/src/lib/map-state.module.ts","../../../projects/services-map-state/src/public-api.ts","../../../projects/services-map-state/src/dlr-eoc-services-map-state.ts"],"sourcesContent":["export interface IMapCenter {\n  lat: number;\n  lon: number;\n}\n\nexport interface IMapStateOptions {\n  maxzoom?: number;\n  minzoom?: number;\n  notifier?: 'user' | 'map';\n}\n\nexport interface IMapState {\n  zoom: number;\n  center: IMapCenter;\n  options?: IMapStateOptions;\n  extent?: TGeoExtent;\n  /** iso 8601 Datestring */\n  time?: string;\n}\n\n/**\n * like ol.extent: minX, minY, maxX, maxY\n */\nexport type TGeoExtent = [number, number, number, number] | [number, number, number, number, number, number];\n\nexport class MapState implements IMapState {\n  zoom: number;\n  center: {\n    lat: number;\n    lon: number;\n  };\n  options: IMapStateOptions;\n  extent: TGeoExtent;\n  /** iso 8601 Datestring */\n  time: string;\n\n  constructor(zoom: number, center: IMapCenter, options?: IMapStateOptions, extent: TGeoExtent = [-180.0, -90.0, 180.0, 90.0], time: string = new Date().toISOString()) {\n    const defaultOptions = {\n      maxzoom: 0,\n      minzoom: 0,\n      notifier: 'map'\n    };\n    this.zoom = zoom;\n    this.center = center;\n    this.extent = extent;\n    this.time = time;\n    this.options = Object.assign(defaultOptions, options);\n  }\n\n\n  public sameCenter(center: IMapState['center']) {\n    if (this.center.lat === center.lat && this.center.lon === center.lon) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public sameZoom(zoom: IMapState['zoom']) {\n    if (this.zoom === zoom) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public sameExtent(extent: TGeoExtent) {\n    const len = extent.length;\n    let isSame = false;\n    if (this.extent.length === len) {\n      isSame = this.extent.every((v, i) => extent[i] === v);\n    }\n    return isSame;\n  }\n\n  public sameNotifier(notifier: IMapState['options']['notifier']) {\n    if (this.options.notifier === notifier) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { MapState, IMapStateOptions, IMapState } from './types/map-state';\nimport { TGeoExtent } from '@dlr-eoc/services-layers';\nimport { map } from 'rxjs/operators';\n\nconst initialState = new MapState(0, { lat: 0, lon: 0 });\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapStateService {\n  private mapState = new BehaviorSubject(initialState)\n  private lastAction = new BehaviorSubject<'setExtent' | 'setState'>(null);\n  constructor() {\n  }\n\n  public getMapState() {\n    return this.mapState;\n  }\n\n  public setMapState(state: MapState | IMapState) {\n    if (!state) {\n      return;\n    }\n    this.lastAction.next('setState');\n    if (state instanceof MapState) {\n      const newState = new MapState(state.zoom, state.center, state.options, state.extent);\n      this.mapState.next(newState);\n    } else {\n      const stateOptions: IMapStateOptions = { ...{ notifier: 'user' }, ...state.options };\n      const newState = new MapState(state.zoom, state.center, stateOptions, state.extent);\n      this.mapState.next(newState);\n    }\n  }\n\n  public getExtent() {\n    return this.mapState.pipe(map((state) => state.extent));\n  }\n\n  public setExtent(extent: TGeoExtent, notifier: IMapState['options']['notifier'] = 'user') {\n    if (!extent) {\n      return;\n    }\n    this.lastAction.next('setExtent');\n    const state = this.getMapState().getValue();\n    state.options.notifier = notifier;\n    const newState = new MapState(state.zoom, state.center, state.options, extent);\n    this.mapState.next(newState);\n  }\n\n\n  public getLastAction() {\n    return this.lastAction;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MapStateService } from './map-state.service';\n@NgModule({\n  declarations: [],\n  imports: [],\n  exports: [],\n  providers: [MapStateService]\n})\nexport class MapStateModule { }\n","/*\n * Public API Surface of services-map-state\n */\n\nexport * from './lib/types/map-state';\nexport * from './lib/map-state.service';\nexport * from './lib/map-state.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}