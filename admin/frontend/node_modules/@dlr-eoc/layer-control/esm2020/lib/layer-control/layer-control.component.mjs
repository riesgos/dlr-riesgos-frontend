import { Component, Input } from '@angular/core';
import { LayerGroup } from '@dlr-eoc/services-layers';
import * as i0 from "@angular/core";
import * as i1 from "../layerentry-group/layerentry-group.component";
import * as i2 from "../layerentry/layerentry.component";
import * as i3 from "@angular/cdk/drag-drop";
import * as i4 from "@angular/common";
import * as i5 from "../utils/array-reverse.pipe";
import * as i6 from "../utils/obj-type.pipe";
export class LayerControlComponent {
    constructor() {
        this.layerfilter = 'Layers';
        this.layergroups = [];
    }
    ngOnInit() {
        this.layerGroupsSubscription = this.layersSvc.getLayerGroups().subscribe(layergroups => {
            this.layergroups = layergroups;
            /**
             * filter only in template so reordering of layers with set layergroups is working
             */
            // this.layergroups = layergroups.filter((group) => group.filtertype === this.layerfilter || group.filtertype === this.layerfilter);
        });
    }
    isLayerGroup(group) {
        if (group instanceof LayerGroup) {
            return true;
        }
        else {
            return false;
        }
    }
    ngOnDestroy() {
        this.layerGroupsSubscription.unsubscribe();
    }
    // CDKDRagAndDrop -------------------------------------------------------------
    // https://material.angular.io/cdk/drag-drop/api
    drop(event) {
        const groupLayers = this.layergroups;
        const groupLeng = groupLayers.length;
        const fiteredLayers = event.container.data; // filtered by [cdkDropListData]
        const groupFiteredLeng = fiteredLayers.length;
        let previousIFinal, newIFinal;
        /**
         * calc index with pipe reverse order
         */
        if (groupLeng === groupFiteredLeng) {
            const previousIndex = groupLeng - event.previousIndex - 1;
            const newIndex = groupLeng - event.currentIndex - 1;
            previousIFinal = previousIndex;
            newIFinal = newIndex;
        }
        else {
            /**
             * If array is filtered get previousIndex by item.data and try to calculate ne index
             * get layers for cdk indexes - 'connect' 'event.container.data' and the original not filtered data
             */
            const newLayer = fiteredLayers[event.currentIndex];
            const previousIndex = groupLayers.findIndex(l => l.id === event.item.data.id);
            let newIndex = groupLayers.findIndex(l => l.id === newLayer.id);
            // Item is not moved
            if (event.previousIndex === event.currentIndex) {
                newIndex = previousIndex;
            }
            previousIFinal = previousIndex;
            newIFinal = newIndex;
        }
        this.layersSvc.arrayMove(this.layergroups, previousIFinal, newIFinal);
        this.layersSvc.setLayerGroups(this.layergroups);
    }
    checkBaselayer(layer, group) {
        if (layer.filtertype === 'Baselayers' || group && group.filtertype === 'Baselayers') {
            return true;
        }
        else {
            return false;
        }
    }
    checkClassHide(layerOrGroup) {
        const hasHide = layerOrGroup?.cssClass?.includes('hide') || false;
        return !hasHide;
    }
}
LayerControlComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.6", ngImport: i0, type: LayerControlComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
LayerControlComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.6", type: LayerControlComponent, selector: "ukis-layer-control", inputs: { layersSvc: "layersSvc", mapStateSvc: "mapStateSvc", layerfilter: "layerfilter" }, ngImport: i0, template: "<div cdkDropList (cdkDropListDropped)=\"drop($event)\"\n  [cdkDropListData]=\"layergroups | itemsfilter: checkClassHide | reverse\">\n  <ng-container *ngFor=\"let group of layergroups | itemsfilter: checkClassHide | reverse\">\n    <div class=\"list-item\" cdkDragLockAxis=\"y\" cdkDrag [cdkDragData]=\"{id:group.id}\">\n      <ukis-layerentry-group *ngIf=\" isLayerGroup(group) && group.filtertype===layerfilter\" [layersSvc]=\"layersSvc\"\n        [mapState]=\"mapStateSvc\" [group]=\"group\" [layerGroups]=\"layergroups\">\n        <span class=\"move-item\" cdkDragHandle>\n          {{group.displayName || group.name}}\n        </span>\n      </ukis-layerentry-group>\n      <ukis-layerentry *ngIf=\"!isLayerGroup(group) && group.filtertype === layerfilter\" [layerGroups]=\"layergroups\"\n        [expanded]=\"false\" [layersSvc]=\"layersSvc\" [mapState]=\"mapStateSvc\" [layer]=\"group\" [group]=\"null\">\n        <span class=\"move-item\" cdkDragHandle>\n          {{group.displayName || group.name}}\n        </span>\n      </ukis-layerentry>\n    </div>\n  </ng-container>\n\n</div>\n", styles: [".list-item{cursor:pointer}.move-item{cursor:move}.cdk-drag-preview{display:flex;align-items:center;padding:15px 10px;box-sizing:border-box;border-radius:2px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;overflow:hidden}.cdk-drag-placeholder{opacity:.2}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box:last-child{border:none}.cdk-drop-list-dragging .list-item:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}\n"], components: [{ type: i1.LayerentryGroupComponent, selector: "ukis-layerentry-group", inputs: ["layersSvc", "mapState", "group", "layerGroups"] }, { type: i2.LayerentryComponent, selector: "ukis-layerentry", inputs: ["layersSvc", "mapState", "layer", "group", "layerGroups", "expanded", "expandable"], outputs: ["update"] }], directives: [{ type: i3.CdkDropList, selector: "[cdkDropList], cdk-drop-list", inputs: ["cdkDropListConnectedTo", "cdkDropListData", "cdkDropListOrientation", "id", "cdkDropListLockAxis", "cdkDropListDisabled", "cdkDropListSortingDisabled", "cdkDropListEnterPredicate", "cdkDropListSortPredicate", "cdkDropListAutoScrollDisabled", "cdkDropListAutoScrollStep"], outputs: ["cdkDropListDropped", "cdkDropListEntered", "cdkDropListExited", "cdkDropListSorted"], exportAs: ["cdkDropList"] }, { type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i3.CdkDrag, selector: "[cdkDrag]", inputs: ["cdkDragData", "cdkDragLockAxis", "cdkDragRootElement", "cdkDragBoundary", "cdkDragStartDelay", "cdkDragFreeDragPosition", "cdkDragDisabled", "cdkDragConstrainPosition", "cdkDragPreviewClass", "cdkDragPreviewContainer"], outputs: ["cdkDragStarted", "cdkDragReleased", "cdkDragEnded", "cdkDragEntered", "cdkDragExited", "cdkDragDropped", "cdkDragMoved"], exportAs: ["cdkDrag"] }, { type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.CdkDragHandle, selector: "[cdkDragHandle]", inputs: ["cdkDragHandleDisabled"] }], pipes: { "reverse": i5.ReversePipe, "itemsfilter": i6.ItemsFilterPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.6", ngImport: i0, type: LayerControlComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ukis-layer-control', template: "<div cdkDropList (cdkDropListDropped)=\"drop($event)\"\n  [cdkDropListData]=\"layergroups | itemsfilter: checkClassHide | reverse\">\n  <ng-container *ngFor=\"let group of layergroups | itemsfilter: checkClassHide | reverse\">\n    <div class=\"list-item\" cdkDragLockAxis=\"y\" cdkDrag [cdkDragData]=\"{id:group.id}\">\n      <ukis-layerentry-group *ngIf=\" isLayerGroup(group) && group.filtertype===layerfilter\" [layersSvc]=\"layersSvc\"\n        [mapState]=\"mapStateSvc\" [group]=\"group\" [layerGroups]=\"layergroups\">\n        <span class=\"move-item\" cdkDragHandle>\n          {{group.displayName || group.name}}\n        </span>\n      </ukis-layerentry-group>\n      <ukis-layerentry *ngIf=\"!isLayerGroup(group) && group.filtertype === layerfilter\" [layerGroups]=\"layergroups\"\n        [expanded]=\"false\" [layersSvc]=\"layersSvc\" [mapState]=\"mapStateSvc\" [layer]=\"group\" [group]=\"null\">\n        <span class=\"move-item\" cdkDragHandle>\n          {{group.displayName || group.name}}\n        </span>\n      </ukis-layerentry>\n    </div>\n  </ng-container>\n\n</div>\n", styles: [".list-item{cursor:pointer}.move-item{cursor:move}.cdk-drag-preview{display:flex;align-items:center;padding:15px 10px;box-sizing:border-box;border-radius:2px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;overflow:hidden}.cdk-drag-placeholder{opacity:.2}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box:last-child{border:none}.cdk-drop-list-dragging .list-item:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}\n"] }]
        }], ctorParameters: function () { return []; }, propDecorators: { layersSvc: [{
                type: Input,
                args: ['layersSvc']
            }], mapStateSvc: [{
                type: Input,
                args: ['mapStateSvc']
            }], layerfilter: [{
                type: Input,
                args: ['layerfilter']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF5ZXItY29udHJvbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9sYXllci1jb250cm9sL3NyYy9saWIvbGF5ZXItY29udHJvbC9sYXllci1jb250cm9sLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xheWVyLWNvbnRyb2wvc3JjL2xpYi9sYXllci1jb250cm9sL2xheWVyLWNvbnRyb2wuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFJcEUsT0FBTyxFQUFFLFVBQVUsRUFBUyxNQUFNLDBCQUEwQixDQUFDOzs7Ozs7OztBQVU3RCxNQUFNLE9BQU8scUJBQXFCO0lBVWhDO1FBUHNCLGdCQUFXLEdBQXdCLFFBQVEsQ0FBQztRQVFoRSxJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUNyRixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztZQUMvQjs7ZUFFRztZQUNILG9JQUFvSTtRQUN0SSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxZQUFZLENBQUMsS0FBeUI7UUFDcEMsSUFBSSxLQUFLLFlBQVksVUFBVSxFQUFFO1lBQy9CLE9BQU8sSUFBSSxDQUFDO1NBQ2I7YUFBTTtZQUNMLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUM3QyxDQUFDO0lBR0QsK0VBQStFO0lBQy9FLGdEQUFnRDtJQUNoRCxJQUFJLENBQUMsS0FBMEM7UUFDN0MsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUNyQyxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDO1FBQ3JDLE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsZ0NBQWdDO1FBQzVFLE1BQU0sZ0JBQWdCLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUM5QyxJQUFJLGNBQWMsRUFBRSxTQUFTLENBQUM7UUFFOUI7O1dBRUc7UUFDSCxJQUFJLFNBQVMsS0FBSyxnQkFBZ0IsRUFBRTtZQUNsQyxNQUFNLGFBQWEsR0FBRyxTQUFTLEdBQUcsS0FBSyxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUM7WUFDMUQsTUFBTSxRQUFRLEdBQUcsU0FBUyxHQUFHLEtBQUssQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1lBQ3BELGNBQWMsR0FBRyxhQUFhLENBQUM7WUFDL0IsU0FBUyxHQUFHLFFBQVEsQ0FBQztTQUN0QjthQUFNO1lBQ0w7OztlQUdHO1lBQ0gsTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNuRCxNQUFNLGFBQWEsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM5RSxJQUFJLFFBQVEsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFaEUsb0JBQW9CO1lBQ3BCLElBQUksS0FBSyxDQUFDLGFBQWEsS0FBSyxLQUFLLENBQUMsWUFBWSxFQUFFO2dCQUM5QyxRQUFRLEdBQUcsYUFBYSxDQUFDO2FBQzFCO1lBRUQsY0FBYyxHQUFHLGFBQWEsQ0FBQztZQUMvQixTQUFTLEdBQUcsUUFBUSxDQUFDO1NBQ3RCO1FBRUQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxjQUFjLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFRCxjQUFjLENBQUMsS0FBWSxFQUFFLEtBQWtCO1FBQzdDLElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxZQUFZLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxVQUFVLEtBQUssWUFBWSxFQUFFO1lBQ25GLE9BQU8sSUFBSSxDQUFDO1NBQ2I7YUFBTTtZQUNMLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7SUFDSCxDQUFDO0lBRUQsY0FBYyxDQUFDLFlBQWdDO1FBQzdDLE1BQU0sT0FBTyxHQUFHLFlBQVksRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQztRQUNsRSxPQUFPLENBQUMsT0FBTyxDQUFDO0lBQ2xCLENBQUM7O2tIQXZGVSxxQkFBcUI7c0dBQXJCLHFCQUFxQixzSkNkbEMsd2tDQW9CQTsyRkROYSxxQkFBcUI7a0JBTGpDLFNBQVM7K0JBQ0Usb0JBQW9COzBFQUtWLFNBQVM7c0JBQTVCLEtBQUs7dUJBQUMsV0FBVztnQkFDSSxXQUFXO3NCQUFoQyxLQUFLO3VCQUFDLGFBQWE7Z0JBQ0UsV0FBVztzQkFBaEMsS0FBSzt1QkFBQyxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgTGF5ZXJzU2VydmljZSB9IGZyb20gJ0BkbHItZW9jL3NlcnZpY2VzLWxheWVycyc7XG5pbXBvcnQgeyBNYXBTdGF0ZVNlcnZpY2UgfSBmcm9tICdAZGxyLWVvYy9zZXJ2aWNlcy1tYXAtc3RhdGUnO1xuaW1wb3J0IHsgTGF5ZXJHcm91cCwgTGF5ZXIgfSBmcm9tICdAZGxyLWVvYy9zZXJ2aWNlcy1sYXllcnMnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IENka0RyYWdEcm9wIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2RyYWctZHJvcCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3VraXMtbGF5ZXItY29udHJvbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9sYXllci1jb250cm9sLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGF5ZXItY29udHJvbC5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIExheWVyQ29udHJvbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCdsYXllcnNTdmMnKSBsYXllcnNTdmM6IExheWVyc1NlcnZpY2U7XG4gIEBJbnB1dCgnbWFwU3RhdGVTdmMnKSBtYXBTdGF0ZVN2Yz86IE1hcFN0YXRlU2VydmljZTtcbiAgQElucHV0KCdsYXllcmZpbHRlcicpIGxheWVyZmlsdGVyOiBMYXllclsnZmlsdGVydHlwZSddID0gJ0xheWVycyc7XG5cbiAgbGF5ZXJHcm91cHNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgbGF5ZXJzU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIGxheWVyZ3JvdXBzOiBBcnJheTxMYXllciB8IExheWVyR3JvdXA+O1xuXG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5sYXllcmdyb3VwcyA9IFtdO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5sYXllckdyb3Vwc1N1YnNjcmlwdGlvbiA9IHRoaXMubGF5ZXJzU3ZjLmdldExheWVyR3JvdXBzKCkuc3Vic2NyaWJlKGxheWVyZ3JvdXBzID0+IHtcbiAgICAgIHRoaXMubGF5ZXJncm91cHMgPSBsYXllcmdyb3VwcztcbiAgICAgIC8qKlxuICAgICAgICogZmlsdGVyIG9ubHkgaW4gdGVtcGxhdGUgc28gcmVvcmRlcmluZyBvZiBsYXllcnMgd2l0aCBzZXQgbGF5ZXJncm91cHMgaXMgd29ya2luZ1xuICAgICAgICovXG4gICAgICAvLyB0aGlzLmxheWVyZ3JvdXBzID0gbGF5ZXJncm91cHMuZmlsdGVyKChncm91cCkgPT4gZ3JvdXAuZmlsdGVydHlwZSA9PT0gdGhpcy5sYXllcmZpbHRlciB8fCBncm91cC5maWx0ZXJ0eXBlID09PSB0aGlzLmxheWVyZmlsdGVyKTtcbiAgICB9KTtcbiAgfVxuXG4gIGlzTGF5ZXJHcm91cChncm91cDogTGF5ZXIgfCBMYXllckdyb3VwKSB7XG4gICAgaWYgKGdyb3VwIGluc3RhbmNlb2YgTGF5ZXJHcm91cCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmxheWVyR3JvdXBzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuXG4gIC8vIENES0RSYWdBbmREcm9wIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gaHR0cHM6Ly9tYXRlcmlhbC5hbmd1bGFyLmlvL2Nkay9kcmFnLWRyb3AvYXBpXG4gIGRyb3AoZXZlbnQ6IENka0RyYWdEcm9wPChMYXllciB8IExheWVyR3JvdXApW10+KSB7XG4gICAgY29uc3QgZ3JvdXBMYXllcnMgPSB0aGlzLmxheWVyZ3JvdXBzO1xuICAgIGNvbnN0IGdyb3VwTGVuZyA9IGdyb3VwTGF5ZXJzLmxlbmd0aDtcbiAgICBjb25zdCBmaXRlcmVkTGF5ZXJzID0gZXZlbnQuY29udGFpbmVyLmRhdGE7IC8vIGZpbHRlcmVkIGJ5IFtjZGtEcm9wTGlzdERhdGFdXG4gICAgY29uc3QgZ3JvdXBGaXRlcmVkTGVuZyA9IGZpdGVyZWRMYXllcnMubGVuZ3RoO1xuICAgIGxldCBwcmV2aW91c0lGaW5hbCwgbmV3SUZpbmFsO1xuXG4gICAgLyoqXG4gICAgICogY2FsYyBpbmRleCB3aXRoIHBpcGUgcmV2ZXJzZSBvcmRlclxuICAgICAqL1xuICAgIGlmIChncm91cExlbmcgPT09IGdyb3VwRml0ZXJlZExlbmcpIHtcbiAgICAgIGNvbnN0IHByZXZpb3VzSW5kZXggPSBncm91cExlbmcgLSBldmVudC5wcmV2aW91c0luZGV4IC0gMTtcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gZ3JvdXBMZW5nIC0gZXZlbnQuY3VycmVudEluZGV4IC0gMTtcbiAgICAgIHByZXZpb3VzSUZpbmFsID0gcHJldmlvdXNJbmRleDtcbiAgICAgIG5ld0lGaW5hbCA9IG5ld0luZGV4O1xuICAgIH0gZWxzZSB7XG4gICAgICAvKipcbiAgICAgICAqIElmIGFycmF5IGlzIGZpbHRlcmVkIGdldCBwcmV2aW91c0luZGV4IGJ5IGl0ZW0uZGF0YSBhbmQgdHJ5IHRvIGNhbGN1bGF0ZSBuZSBpbmRleFxuICAgICAgICogZ2V0IGxheWVycyBmb3IgY2RrIGluZGV4ZXMgLSAnY29ubmVjdCcgJ2V2ZW50LmNvbnRhaW5lci5kYXRhJyBhbmQgdGhlIG9yaWdpbmFsIG5vdCBmaWx0ZXJlZCBkYXRhXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IG5ld0xheWVyID0gZml0ZXJlZExheWVyc1tldmVudC5jdXJyZW50SW5kZXhdO1xuICAgICAgY29uc3QgcHJldmlvdXNJbmRleCA9IGdyb3VwTGF5ZXJzLmZpbmRJbmRleChsID0+IGwuaWQgPT09IGV2ZW50Lml0ZW0uZGF0YS5pZCk7XG4gICAgICBsZXQgbmV3SW5kZXggPSBncm91cExheWVycy5maW5kSW5kZXgobCA9PiBsLmlkID09PSBuZXdMYXllci5pZCk7XG5cbiAgICAgIC8vIEl0ZW0gaXMgbm90IG1vdmVkXG4gICAgICBpZiAoZXZlbnQucHJldmlvdXNJbmRleCA9PT0gZXZlbnQuY3VycmVudEluZGV4KSB7XG4gICAgICAgIG5ld0luZGV4ID0gcHJldmlvdXNJbmRleDtcbiAgICAgIH1cblxuICAgICAgcHJldmlvdXNJRmluYWwgPSBwcmV2aW91c0luZGV4O1xuICAgICAgbmV3SUZpbmFsID0gbmV3SW5kZXg7XG4gICAgfVxuXG4gICAgdGhpcy5sYXllcnNTdmMuYXJyYXlNb3ZlKHRoaXMubGF5ZXJncm91cHMsIHByZXZpb3VzSUZpbmFsLCBuZXdJRmluYWwpO1xuICAgIHRoaXMubGF5ZXJzU3ZjLnNldExheWVyR3JvdXBzKHRoaXMubGF5ZXJncm91cHMpO1xuICB9XG5cbiAgY2hlY2tCYXNlbGF5ZXIobGF5ZXI6IExheWVyLCBncm91cD86IExheWVyR3JvdXApIHtcbiAgICBpZiAobGF5ZXIuZmlsdGVydHlwZSA9PT0gJ0Jhc2VsYXllcnMnIHx8IGdyb3VwICYmIGdyb3VwLmZpbHRlcnR5cGUgPT09ICdCYXNlbGF5ZXJzJykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBjaGVja0NsYXNzSGlkZShsYXllck9yR3JvdXA6IExheWVyIHwgTGF5ZXJHcm91cCkge1xuICAgIGNvbnN0IGhhc0hpZGUgPSBsYXllck9yR3JvdXA/LmNzc0NsYXNzPy5pbmNsdWRlcygnaGlkZScpIHx8IGZhbHNlO1xuICAgIHJldHVybiAhaGFzSGlkZTtcbiAgfVxufVxuIiwiPGRpdiBjZGtEcm9wTGlzdCAoY2RrRHJvcExpc3REcm9wcGVkKT1cImRyb3AoJGV2ZW50KVwiXG4gIFtjZGtEcm9wTGlzdERhdGFdPVwibGF5ZXJncm91cHMgfCBpdGVtc2ZpbHRlcjogY2hlY2tDbGFzc0hpZGUgfCByZXZlcnNlXCI+XG4gIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGdyb3VwIG9mIGxheWVyZ3JvdXBzIHwgaXRlbXNmaWx0ZXI6IGNoZWNrQ2xhc3NIaWRlIHwgcmV2ZXJzZVwiPlxuICAgIDxkaXYgY2xhc3M9XCJsaXN0LWl0ZW1cIiBjZGtEcmFnTG9ja0F4aXM9XCJ5XCIgY2RrRHJhZyBbY2RrRHJhZ0RhdGFdPVwie2lkOmdyb3VwLmlkfVwiPlxuICAgICAgPHVraXMtbGF5ZXJlbnRyeS1ncm91cCAqbmdJZj1cIiBpc0xheWVyR3JvdXAoZ3JvdXApICYmIGdyb3VwLmZpbHRlcnR5cGU9PT1sYXllcmZpbHRlclwiIFtsYXllcnNTdmNdPVwibGF5ZXJzU3ZjXCJcbiAgICAgICAgW21hcFN0YXRlXT1cIm1hcFN0YXRlU3ZjXCIgW2dyb3VwXT1cImdyb3VwXCIgW2xheWVyR3JvdXBzXT1cImxheWVyZ3JvdXBzXCI+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwibW92ZS1pdGVtXCIgY2RrRHJhZ0hhbmRsZT5cbiAgICAgICAgICB7e2dyb3VwLmRpc3BsYXlOYW1lIHx8IGdyb3VwLm5hbWV9fVxuICAgICAgICA8L3NwYW4+XG4gICAgICA8L3VraXMtbGF5ZXJlbnRyeS1ncm91cD5cbiAgICAgIDx1a2lzLWxheWVyZW50cnkgKm5nSWY9XCIhaXNMYXllckdyb3VwKGdyb3VwKSAmJiBncm91cC5maWx0ZXJ0eXBlID09PSBsYXllcmZpbHRlclwiIFtsYXllckdyb3Vwc109XCJsYXllcmdyb3Vwc1wiXG4gICAgICAgIFtleHBhbmRlZF09XCJmYWxzZVwiIFtsYXllcnNTdmNdPVwibGF5ZXJzU3ZjXCIgW21hcFN0YXRlXT1cIm1hcFN0YXRlU3ZjXCIgW2xheWVyXT1cImdyb3VwXCIgW2dyb3VwXT1cIm51bGxcIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJtb3ZlLWl0ZW1cIiBjZGtEcmFnSGFuZGxlPlxuICAgICAgICAgIHt7Z3JvdXAuZGlzcGxheU5hbWUgfHwgZ3JvdXAubmFtZX19XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIDwvdWtpcy1sYXllcmVudHJ5PlxuICAgIDwvZGl2PlxuICA8L25nLWNvbnRhaW5lcj5cblxuPC9kaXY+XG4iXX0=