import { createShaderProgram, createFloatBuffer, getAttributeLocation, bindBufferToAttribute, clearBackground, getUniformLocation, bindTextureToUniform, bindProgram, createTexture } from './webgl';
import { rectangleA } from './engine.shapes';
export const displayImageOn = (canvas, image) => {
    const gl = canvas.getContext('webgl');
    if (!gl) {
        throw new Error('No context');
    }
    const vertexShaderSource = `
    attribute vec4 a_vertex;
    attribute vec2 a_textureCoord;
    varying vec2 v_textureCoord;
    void main() {
        v_textureCoord = a_textureCoord;
        gl_Position = a_vertex;
    }
    `;
    const fragmentShaderSource = `
    precision mediump float;
    uniform sampler2D u_texture;
    // uniform vec2 u_textureSize;
    varying vec2 v_textureCoord;
    void main() {
        // vec2 delta = vec2(1., 1.) / u_textureSize;
        gl_FragColor = texture2D(u_texture, v_textureCoord); //  * 0. + vec4(5., 5., 0., 1.);
    }
    `;
    const program = createShaderProgram(gl, vertexShaderSource, fragmentShaderSource);
    bindProgram(gl, program);
    const rct = rectangleA(1.3, 1.3);
    const bxData = createFloatBuffer(gl, rct.vertices);
    const bxLoc = getAttributeLocation(gl, program, 'a_vertex');
    bindBufferToAttribute(gl, bxLoc, bxData);
    const texCoords = createFloatBuffer(gl, rct.texturePositions);
    const texCoordsLoc = getAttributeLocation(gl, program, 'a_textureCoord');
    bindBufferToAttribute(gl, texCoordsLoc, texCoords);
    const texture = createTexture(gl, image);
    const textureLoc = getUniformLocation(gl, program, 'u_texture');
    bindTextureToUniform(gl, texture.texture, 0, textureLoc);
    clearBackground(gl, [.9, .9, .9, 1.0]);
    gl.drawArrays(gl.TRIANGLES, 0, rct.vertices.length);
};
export const createTextCanvas = (text, width = 256, height = 256, color = 'red') => {
    const ctx = document.createElement('canvas').getContext('2d');
    if (!ctx) {
        throw new Error('no context');
    }
    ctx.canvas.width = width;
    ctx.canvas.height = height;
    ctx.font = `bold ${height * 5 / 6 | 0}px sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = color;
    ctx.fillText(text, width / 2, height / 2);
    return ctx.canvas;
};
export const canvasToImage = (canvas) => {
    const image = document.createElement('img');
    image.width = canvas.width;
    image.height = canvas.height;
    image.src = canvas.toDataURL('image/png');
    return image;
};
export const arrayToCanvas = (data) => {
    const rows = data.length;
    const cols = data[0].length;
    const buffer = new Uint8ClampedArray(cols * rows * 4);
    for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
            const pos = (r * cols + c) * 4;
            buffer[pos] = data[r][c][0];
            buffer[pos + 1] = data[r][c][1];
            buffer[pos + 2] = data[r][c][2];
            buffer[pos + 3] = data[r][c][3];
        }
    }
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = cols;
    canvas.height = rows;
    const imageDataContainer = ctx.createImageData(cols, rows);
    imageDataContainer.data.set(buffer);
    ctx.putImageData(imageDataContainer, 0, 0);
    return canvas;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5naW5lLmhlbHBlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91dGlscy1tYXBzL3NyYy9saWIvd2ViZ2wvZW5naW5lLmhlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQixtQkFBbUIsRUFBRSxpQkFBaUIsRUFBRSxvQkFBb0IsRUFBRSxxQkFBcUIsRUFBRSxlQUFlLEVBQUUsa0JBQWtCLEVBQUUsb0JBQW9CLEVBQUUsV0FBVyxFQUFzQixhQUFhLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDeE8sT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBSTdDLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxDQUFDLE1BQXlCLEVBQUUsS0FBdUIsRUFBUSxFQUFFO0lBRXZGLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdEMsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7S0FDakM7SUFFRCxNQUFNLGtCQUFrQixHQUFHOzs7Ozs7OztLQVExQixDQUFDO0lBQ0YsTUFBTSxvQkFBb0IsR0FBRzs7Ozs7Ozs7O0tBUzVCLENBQUM7SUFDRixNQUFNLE9BQU8sR0FBRyxtQkFBbUIsQ0FBQyxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztJQUNsRixXQUFXLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRXpCLE1BQU0sR0FBRyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFakMsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNuRCxNQUFNLEtBQUssR0FBRyxvQkFBb0IsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLFVB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LENBQUMsTUFBTSxDQUFDLENBQUM7SUFDcEMsR0FBRyxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFM0MsT0FBTyxNQUFNLENBQUM7QUFDbEIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGV4dHVyZU9iamVjdCwgY3JlYXRlU2hhZGVyUHJvZ3JhbSwgY3JlYXRlRmxvYXRCdWZmZXIsIGdldEF0dHJpYnV0ZUxvY2F0aW9uLCBiaW5kQnVmZmVyVG9BdHRyaWJ1dGUsIGNsZWFyQmFja2dyb3VuZCwgZ2V0VW5pZm9ybUxvY2F0aW9uLCBiaW5kVGV4dHVyZVRvVW5pZm9ybSwgYmluZFByb2dyYW0sIGJpbmRWYWx1ZVRvVW5pZm9ybSwgY3JlYXRlVGV4dHVyZSB9IGZyb20gJy4vd2ViZ2wnO1xuaW1wb3J0IHsgcmVjdGFuZ2xlQSB9IGZyb20gJy4vZW5naW5lLnNoYXBlcyc7XG5cblxuXG5leHBvcnQgY29uc3QgZGlzcGxheUltYWdlT24gPSAoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCwgaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQpOiB2b2lkID0+IHtcblxuICAgIGNvbnN0IGdsID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7XG4gICAgaWYgKCFnbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGNvbnRleHQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB2ZXJ0ZXhTaGFkZXJTb3VyY2UgPSBgXG4gICAgYXR0cmlidXRlIHZlYzQgYV92ZXJ0ZXg7XG4gICAgYXR0cmlidXRlIHZlYzIgYV90ZXh0dXJlQ29vcmQ7XG4gICAgdmFyeWluZyB2ZWMyIHZfdGV4dHVyZUNvb3JkO1xuICAgIHZvaWQgbWFpbigpIHtcbiAgICAgICAgdl90ZXh0dXJlQ29vcmQgPSBhX3RleHR1cmVDb29yZDtcbiAgICAgICAgZ2xfUG9zaXRpb24gPSBhX3ZlcnRleDtcbiAgICB9XG4gICAgYDtcbiAgICBjb25zdCBmcmFnbWVudFNoYWRlclNvdXJjZSA9IGBcbiAgICBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDtcbiAgICB1bmlmb3JtIHNhbXBsZXIyRCB1X3RleHR1cmU7XG4gICAgLy8gdW5pZm9ybSB2ZWMyIHVfdGV4dHVyZVNpemU7XG4gICAgdmFyeWluZyB2ZWMyIHZfdGV4dHVyZUNvb3JkO1xuICAgIHZvaWQgbWFpbigpIHtcbiAgICAgICAgLy8gdmVjMiBkZWx0YSA9IHZlYzIoMS4sIDEuKSAvIHVfdGV4dHVyZVNpemU7XG4gICAgICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCh1X3RleHR1cmUsIHZfdGV4dHVyZUNvb3JkKTsgLy8gICogMC4gKyB2ZWM0KDUuLCA1LiwgMC4sIDEuKTtcbiAgICB9XG4gICAgYDtcbiAgICBjb25zdCBwcm9ncmFtID0gY3JlYXRlU2hhZGVyUHJvZ3JhbShnbCwgdmVydGV4U2hhZGVyU291cmNlLCBmcmFnbWVudFNoYWRlclNvdXJjZSk7XG4gICAgYmluZFByb2dyYW0oZ2wsIHByb2dyYW0pO1xuXG4gICAgY29uc3QgcmN0ID0gcmVjdGFuZ2xlQSgxLjMsIDEuMyk7XG5cbiAgICBjb25zdCBieERhdGEgPSBjcmVhdGVGbG9hdEJ1ZmZlcihnbCwgcmN0LnZlcnRpY2VzKTtcbiAgICBjb25zdCBieExvYyA9IGdldEF0dHJpYnV0ZUxvY2F0aW9uKGdsLCBwcm9ncmFtLCAnYV92ZXJ0ZXgnKTtcbiAgICBiaW5kQnVmZmVyVG9BdHRyaWJ1dGUoZ2wsIGJ4TG9jLCBieERhdGEpO1xuXG4gICAgY29uc3QgdGV4Q29vcmRzID0gY3JlYXRlRmxvYXRCdWZmZXIoZ2wsIHJjdC50ZXh0dXJlUG9zaXRpb25zKTtcbiAgICBjb25zdCB0ZXhDb29yZHNMb2MgPSBnZXRBdHRyaWJ1dGVMb2NhdGlvbihnbCwgcHJvZ3JhbSwgJ2FfdGV4dHVyZUNvb3JkJyk7XG4gICAgYmluZEJ1ZmZlclRvQXR0cmlidXRlKGdsLCB0ZXhDb29yZHNMb2MsIHRleENvb3Jkcyk7XG5cbiAgICBjb25zdCB0ZXh0dXJlID0gY3JlYXRlVGV4dHVyZShnbCwgaW1hZ2UpO1xuICAgIGNvbnN0IHRleHR1cmVMb2MgPSBnZXRVbmlmb3JtTG9jYXRpb24oZ2wsIHByb2dyYW0sICd1X3RleHR1cmUnKTtcbiAgICBiaW5kVGV4dHVyZVRvVW5pZm9ybShnbCwgdGV4dHVyZS50ZXh0dXJlLCAwLCB0ZXh0dXJlTG9jKTtcblxuICAgIGNsZWFyQmFja2dyb3VuZChnbCwgWy45LCAuOSwgLjksIDEuMF0pO1xuICAgIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVTLCAwLCByY3QudmVydGljZXMubGVuZ3RoKTtcbn07XG5cblxuXG5leHBvcnQgY29uc3QgY3JlYXRlVGV4dENhbnZhcyA9ICh0ZXh0OiBzdHJpbmcsIHdpZHRoOiBudW1iZXIgPSAyNTYsIGhlaWdodDogbnVtYmVyID0gMjU2LCBjb2xvcjogc3RyaW5nID0gJ3JlZCcpID0+IHtcbiAgICBjb25zdCBjdHggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKS5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGlmICghY3R4KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignbm8gY29udGV4dCcpO1xuICAgIH1cbiAgICBjdHguY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgY3R4LmNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgY3R4LmZvbnQgPSBgYm9sZCAke2hlaWdodCAqIDUgLyA2IHwgMH1weCBzYW5zLXNlcmlmYDtcbiAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7XG4gICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnO1xuICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjtcbiAgICBjdHguZmlsbFRleHQodGV4dCwgd2lkdGggLyAyLCBoZWlnaHQgLyAyKTtcbiAgICByZXR1cm4gY3R4LmNhbnZhcztcbn07XG5cblxuZXhwb3J0IGNvbnN0IGNhbnZhc1RvSW1hZ2UgPSAoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCk6IEhUTUxJbWFnZUVsZW1lbnQgPT4ge1xuICAgIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgaW1hZ2Uud2lkdGggPSBjYW52YXMud2lkdGg7XG4gICAgaW1hZ2UuaGVpZ2h0ID0gY2FudmFzLmhlaWdodDtcbiAgICBpbWFnZS5zcmMgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTtcbiAgICByZXR1cm4gaW1hZ2U7XG59O1xuXG5leHBvcnQgY29uc3QgYXJyYXlUb0NhbnZhcyA9IChkYXRhOiBudW1iZXJbXVtdW10pID0+IHtcbiAgICBjb25zdCByb3dzID0gZGF0YS5sZW5ndGg7XG4gICAgY29uc3QgY29scyA9IGRhdGFbMF0ubGVuZ3RoO1xuXG4gICAgY29uc3QgYnVmZmVyID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGNvbHMgKiByb3dzICogNCk7XG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCByb3dzOyByKyspIHtcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjb2xzOyBjKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IChyICogY29scyArIGMpICogNDtcbiAgICAgICAgICAgIGJ1ZmZlcltwb3MgICAgXSA9IGRhdGFbcl1bY11bMF07XG4gICAgICAgICAgICBidWZmZXJbcG9zICsgMV0gPSBkYXRhW3JdW2NdWzFdO1xuICAgICAgICAgICAgYnVmZmVyW3BvcyArIDJdID0gZGF0YVtyXVtjXVsyXTtcbiAgICAgICAgICAgIGJ1ZmZlcltwb3MgKyAzXSA9IGRhdGFbcl1bY11bM107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjYW52YXMud2lkdGggPSBjb2xzO1xuICAgIGNhbnZhcy5oZWlnaHQgPSByb3dzO1xuICAgIGNvbnN0IGltYWdlRGF0YUNvbnRhaW5lciA9IGN0eC5jcmVhdGVJbWFnZURhdGEoY29scywgcm93cyk7XG4gICAgaW1hZ2VEYXRhQ29udGFpbmVyLmRhdGEuc2V0KGJ1ZmZlcik7XG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGFDb250YWluZXIsIDAsIDApO1xuXG4gICAgcmV0dXJuIGNhbnZhcztcbn07XG5cbiJdfQ==